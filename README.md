# PTCRISync API service

## Overview

PTCRISync SaaS is a RESTful API mediator for your CRIS. This solution enables any non-Java software to communicate and synchronize OrRCID data using the PTCRISync Java library (https://github.com/fccn/PTCRISync/wiki). PTCRISync SaaS is also a standalone service that can be installed and configured on your local server, providing the PTCRISync available methods (Import/Export) and enabling your application to synchronize data with ORCID using the PTCRISync java library (https://ptcris.pt/en/hub-ptcris-en/) and the ORCID Java Client (https://gitlab.fccn.pt/dev-degois/orcid-java-client).

Important notes:
 - This software has two major dependencies in order to work properly: 
    - the ORCID Java Client library (https://gitlab.fccn.pt/dev-degois/orcid-java-client)  
    - a the PTCRISync library (https://github.com/fccn/PTCRISync)
 - This software requires a valid ORCID Token to enable the usage of the available methods, as it does not provide any way to grab the token. Please check the ORCID Java Client library (https://gitlab.fccn.pt/dev-degois/orcid-java-client).

Please, visit our sandbox and demo service online at: https://sandbox-sync.ptcris.pt/

## Configuration

This software is prepared to run almost as is. In order to work properly you will need first to configure ORCID 's API data:

Please make a copy of the file ```orcid.properties.default``` to ```orcid.properties``` and do the required changes:

https://gitlab.fccn.pt/dev-ptcris/sync-web-api/blob/master/src/main/resources/etc/orcid.properties.default

```
# ORCID's URL for login
orcid.login_url = https://sandbox.orcid.org

# ORCID's API URL
orcid.api_url = https://api.sandbox.orcid.org

# Your PAGE REDIRECTION - we will use Google's playground
orcid.redirect_url = https://developers.google.com/oauthplayground

# Your ORCID's Client ID
orcid.client_id = 0000-0001-2345-6789

# Your ORCID's Client Secret
orcid.client_secret = 00123456-789a-bcde-f012-3456789abcde
```

### Security Configuration

We use Apache Shiro for security purposes. By default, you can use the ```APIKEY``` token as an header to call methods:

```
curl -X GET --header 'Accept: text/html' --header 'apikey: APIKEY' 'https://sandbox-sync.ptcris.pt/v2.0/0000-0002-6305-4618/progress'
```

but you can configure a special token for your API usage. You can specify one at shiro.ini file replacing ```APIKEY``` with your token hash: 
 
https://gitlab.fccn.pt/dev-ptcris/sync-web-api/blob/master/src/main/resources/config/shiro.ini#L7

```
apiKeyFilter.tokens = default:APIKEY 
```

## Deploying the server

This server was generated by the [swagger-codegen](https://github.com/swagger-api/swagger-codegen) project. By using the 
[OpenAPI-Spec](https://github.com/swagger-api/swagger-core/wiki) from a remote server, you can easily generate a server stub.  This
is an example of building a swagger-enabled JAX-RS server.

This example uses the [JAX-RS](https://jax-rs-spec.java.net/) framework.

To run the server, please execute the following:

```
mvn clean package jetty:run
```

You can then view the swagger listing here:

```
http://localhost:8080/v2.0_rc2/swagger.json
```

Note that if you have configured the `host` to be something other than localhost, the calls through
swagger-ui will be directed to that host and not localhost!


## Usage

Please note that in order for you to use this service you will need firstly to grab an valid Orcid Access Token. Please check more details on how to do it at PTCriSync wiki page:
https://github.com/fccn/PTCRISync/wiki/ORCID-Overview#orcid-member-api

Example from Orcid's documentation:
```
https://sandbox.orcid.org/oauth/authorize?client_id=APP-NPXKK6HFN6TJ4YYI&response_type=code&scope=/read-limited&redirect_uri=https://developers.google.com/oauthplayground
```
Note: You can also use [Orcid's Sandbox Swagger interface](https://api.sandbox.orcid.org/) to grab the access token.

With this ORCID acess token you can use the ORCID with a specific ```APIKEY``` to make API requests.

For requests you need use ORCID's JSON format (application/json) for Works. If your system wants to fetch all Works from Orcid, you will need to use and empty JSON array:
```
[]
```

Example:
```
curl -X POST --header 'Content-Type: application/json' --header 'Accept: application/json' --header 'token: MY-ORCID-ACCESS-TOKEN' --header 'apikey: APIKEY' -d '[]' 'https://sandbox-sync.ptcris.pt/v2.0/0000-0002-6305-4618/work/import?update=false'
```

The expected response will be:

```
[
  {
    "created-date": null,
    "last-modified-date": null,
    "source": {
      "source-orcid": {
        "uri": "http://sandbox.orcid.org/0000-0002-6305-4618",
        "path": null,
        "host": "sandbox.orcid.org"
      },
      "source-client-id": {
        "uri": null,
        "path": null,
        "host": null
      },
      "source-name": {
        "value": "Marina PTCRIS R. Cunha"
      }
    },
    "path": "/0000-0002-6305-4618/work/706128",
    "title": {
      "title": {
        "value": "First record of a Vestimentifera (Polychaeta: Siboglinidae) from chemosynthetic habitats in the western Mediterranean Sea-Biogeographical implications and future exploration"
      },
      "subtitle": null,
      "translated-title": null
    },
    "journal-title": {
      "value": "Deep-Sea Research Part I: Oceanographic Research Papers"
    },
    "short-description": null,
    "citation": {
      "citation-type": "BIBTEX",
      "citation-value": "@article{cunha2011, title= {First record of a Vestimentifera (Polychaeta: Siboglinidae) from chemosynthetic habitats in the western Mediterranean Sea-Biogeographical implications and future exploration}, journal= {Deep-Sea Research Part I: Oceanographic Research Papers}, year= {2011}, volume= {58}, number= {2}, pages= {200-207}, author= {Hilário, A. and Comas, M.C. and Azevedo, L. and Pinheiro, L. and Ivanov, M.K. and Cunha, M.R.}}\n\n"
    },
    "type": "JOURNAL_ARTICLE",
    "publication-date": {
      "year": {
        "value": "2011"
      },
      "month": null,
      "day": null,
      "media-type": null
    },
    "external-ids": {
      "external-id": [
        {
          "external-id-type": "doi",
          "external-id-value": "10.1016/j.dsr.2010.11.009",
          "external-id-url": {
            "value": "http://dx.doi.org/10.1016/j.dsr.2010.11.009"
          },
          "external-id-relationship": "SELF"
        },
        {
          "external-id-type": "eid",
          "external-id-value": "2-s2.0-79451472239",
          "external-id-url": {
            "value": "http://www.scopus.com/inward/record.url?eid=2-s2.0-79451472239&partnerID=MN8TOARS"
          },
          "external-id-relationship": "SELF"
        },
        {
          "external-id-type": "handle",
          "external-id-value": "http://hdl.handle.net/10400.26/14471",
          "external-id-url": {
            "value": "http://hdl.handle.net/10400.26/14471"
          },
          "external-id-relationship": "SELF"
        },
        {
          "external-id-type": "eid",
          "external-id-value": "2-s2.0-79451472239",
          "external-id-url": {
            "value": null
          },
          "external-id-relationship": "SELF"
        },
        {
          "external-id-type": "handle",
          "external-id-value": "http://hdl.handle.net/10400.26/14471",
          "external-id-url": {
            "value": null
          },
          "external-id-relationship": "SELF"
        },
        {
          "external-id-type": "doi",
          "external-id-value": "10.1016/j.dsr.2010.11.009",
          "external-id-url": {
            "value": null
          },
          "external-id-relationship": "SELF"
        }
      ]
    },
    "url": null,
    "contributors": {
      "contributor": []
    },
    "language-code": null,
    "country": null,
    "visibility": "PUBLIC"
  }
]
```



Example of an Import differences request:

```
POST https://sandbox-sync.ptcris.pt/v2.0/0000-0002-6305-4618/work/import?update=true
```

```
curl -X POST --header 'Content-Type: application/json' --header 'Accept: application/json' --header 'token: MY-ORCID-ACCESS-TOKEN' --header 'apikey: APIKEY' -d '[ \ 
     { \ 
         "created-date": { \ 
           "value": 1490893077951 \ 
         }, \ 
         "last-modified-date": { \ 
           "value": 1491232101416 \ 
         }, \ 
         "source": { \ 
           "source-orcid": null, \ 
           "source-client-id": { \ 
             "uri": "https://sandbox.orcid.org/client/0000-0002-3788-2479", \ 
             "path": "0000-0002-3788-2479", \ 
             "host": "sandbox.orcid.org" \ 
           }, \ 
           "source-name": { \ 
             "value": "Repositorio Científico de Acesso Aberto de Portugal" \ 
           } \ 
         }, \ 
         "put-code": 783470, \ 
         "path": null, \ 
         "title": { \ 
           "title": { \ 
             "value": "First record of a Vestimentifera (Polychaeta: Siboglinidae) from chemosynthetic habitats in the western Mediterranean Sea-Biogeographical implications and future exploration" \ 
           }, \ 
           "subtitle": { \ 
             "value": "" \ 
           }, \ 
           "translated-title": null \ 
         }, \ 
         "journal-title": { \ 
           "value": "Deep-Sea Research Part I: Oceanographic Research Papers" \ 
         }, \ 
         "short-description": "", \ 
         "citation": { \ 
           "citation-type": "BIBTEX", \ 
           "citation-value": "%40article{cunha2011, title= {First record of a Vestimentifera (Polychaeta: Siboglinidae) from chemosynthetic habitats in the western Mediterranean Sea-Biogeographical implications and future exploration}, journal= {Deep-Sea Research Part I: Oceanographic Research Papers}, year= {2011}, volume= {58}, number= {2}, pages= {200-207}, author= {Hilário, A. and Comas, M.C. and Azevedo, L. and Pinheiro, L. and Ivanov, M.K. and Cunha, M.R.}}\n\n" \ 
         }, \ 
         "type": "JOURNAL_ARTICLE", \ 
         "publication-date": { \ 
           "year": { \ 
             "value": "2011" \ 
           }, \ 
           "month": null, \ 
           "day": null, \ 
           "media-type": null \ 
         }, \ 
         "external-ids": { \ 
           "external-id": [ \ 
             { \ 
               "external-id-type": "doi", \ 
               "external-id-value": "10.1016/j.dsr.2010.11.009", \ 
               "external-id-url": { \ 
                 "value": "" \ 
               }, \ 
               "external-id-relationship": "SELF" \ 
             }, \ 
             { \ 
               "external-id-type": "eid", \ 
               "external-id-value": "2-s2.0-79451472239", \ 
               "external-id-url": { \ 
                 "value": "" \ 
               }, \ 
               "external-id-relationship": "SELF" \ 
             }, \ 
             { \ 
               "external-id-type": "handle", \ 
               "external-id-value": "http://hdl.handle.net/10400.26/14471", \ 
               "external-id-url": { \ 
                 "value": "" \ 
               }, \ 
               "external-id-relationship": "SELF" \ 
             } \ 
           ] \ 
         }, \ 
         "url": { \ 
           "value": "" \ 
         },         \ 
         "language-code": null, \ 
         "country": null, \ 
         "visibility": "PUBLIC" \ 
       } \ 
   ]' 'https://sandbox-sync.ptcris.pt/v2.0/0000-0002-6305-4618/work/import?update=false'
```


## License and Warranty
This software is published under MIT lincense. Please check the [software license](LICENSE.md).